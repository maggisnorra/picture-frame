:80 {
  encode gzip

  # FastAPI under /api/*
  @api path /api/*
  handle @api {
    reverse_proxy api:8000
  }

  # Optional: ensure SSE flushes quickly
  @sse path /api/events
  handle @sse {
    reverse_proxy api:8000 {
      flush_interval -1
    }
  }

  # React SPA (supports /adam and /steve routes)
  root * /srv
  try_files {path} /index.html
  file_server
}
